<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>Quick Reference - Core API</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="highlight/solarized-light.css" /><script type="text/javascript" src="highlight/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a> with <a href="https://github.com/xsc/codox-theme-rdash">RDash UI</a> theme</h2><h1><a href="index.html"><span class="project-title"><span class="project-name">tech.ml.dataset</span> <span class="project-version">5.00-beta-1</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1 "><a href="columns-readers-and-datatypes.html"><div class="inner"><span>Columns, Readers, and Datatypes</span></div></a></li><li class="depth-1 "><a href="nippy-serialization-rocks.html"><div class="inner"><span>Nippy Rocks!</span></div></a></li><li class="depth-1  current"><a href="quick-reference.html"><div class="inner"><span>Quick Reference - Core API</span></div></a></li><li class="depth-1 "><a href="walkthrough.html"><div class="inner"><span>tech.ml.dataset Walkthrough</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>tech</span></div></div></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>v3</span></div></div></li><li class="depth-3"><a href="tech.v3.dataset.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>dataset</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.dataset.categorical.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>categorical</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.dataset.column.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>column</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.dataset.column-filters.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>column-filters</span></div></a></li><li class="depth-4"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>io</span></div></div></li><li class="depth-5 branch"><a href="tech.v3.dataset.io.datetime.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>datetime</span></div></a></li><li class="depth-5 branch"><a href="tech.v3.dataset.io.string-row-parser.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>string-row-parser</span></div></a></li><li class="depth-5"><a href="tech.v3.dataset.io.univocity.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>univocity</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.dataset.join.html"><div class="inner"><span class="tree" style="top: -114px;"><span class="top" style="height: 123px;"></span><span class="bottom"></span></span><span>join</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.dataset.math.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>math</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.dataset.modelling.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>modelling</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.dataset.neanderthal.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>neanderthal</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.dataset.print.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>print</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.dataset.reductions.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>reductions</span></div></a></li><li class="depth-4"><a href="tech.v3.dataset.tensor.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>tensor</span></div></a></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree" style="top: -455px;"><span class="top" style="height: 464px;"></span><span class="bottom"></span></span><span>libs</span></div></div></li><li class="depth-4 branch"><a href="tech.v3.libs.arrow.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>arrow</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.libs.fastexcel.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>fastexcel</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.libs.parquet.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>parquet</span></div></a></li><li class="depth-4"><a href="tech.v3.libs.poi.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>poi</span></div></a></li></ul></div><div class="document" id="content"><div class="doc"><div class="markdown"><h1><a href="#quick-reference-core-api" name="quick-reference-core-api"></a>Quick Reference - Core API</h1>
<p>Functions are linked to their source but if no namespace is specified they are also accessible via the <code>tech.ml.dataset</code> namespace.</p>
<p>This is not an exhaustive listing of all functionality; just a quick brief way to find functions that are we find most useful.</p>
<h2><a href="#loading-saving" name="loading-saving"></a>Loading/Saving</h2>
<ul>
  <li><a href="https://github.com/techascent/tech.ml.dataset/blob/7c8c7514e0e35995050c1e326122a1826cc18273/src/tech/v3/dataset/io.clj#L87">-&gt;dataset, -&gt;&gt;dataset</a> - loads csv, tsv,  sequence-of-maps, map-of-arrays, xlsx, xls, parquet and arrow.</li>
  <li><a href="https://github.com/techascent/tech.ml.dataset/blob/7c8c7514e0e35995050c1e326122a1826cc18273/src/tech/v3/dataset/io.clj#L203">write!</a> - Writes csv or tsv with  gzipping. Depends on scanning file path string to determine options.</li>
  <li><a href="https://github.com/techascent/tech.ml.dataset/blob/7c8c7514e0e35995050c1e326122a1826cc18273/src/tech/v3/dataset/io/nippy.clj">nippy freeze/thaw support</a></li>
  <li><a href="https://github.com/techascent/tech.ml.dataset/blob/7c8c7514e0e35995050c1e326122a1826cc18273/src/tech/v3/dataset/base.clj#L666">dataset-&gt;data</a> - Useful if you want the entire  dataset represented as (mostly) pure Clojure/JVM datastructures. Missing sets are  roaring bitmaps, data is probably in primitive arrays. String tables receive special  treatment.</li>
  <li><a href="https://github.com/techascent/tech.ml.dataset/blob/7c8c7514e0e35995050c1e326122a1826cc18273/src/tech/v3/dataset/base.clj#L694">data-&gt;dataset</a> - Inverse of data-&gt;dataset.</li>
  <li><a href="https://github.com/techascent/tech.ml.dataset/blob/7c8c7514e0e35995050c1e326122a1826cc18273/src/tech/v3/dataset/io/univocity.clj#L144">tech.ml.dataset.io.univocity/csv-&gt;rows</a> - Lazily parse a  csv or tsv returning a sequence of string[] rows. This uses a subset of the -&gt;dataset options.</li>
  <li><a href="https://github.com/techascent/tech.ml.dataset/blob/7c8c7514e0e35995050c1e326122a1826cc18273/src/tech/v3/dataset/io/string_row_parser.clj#L13">tech.ml.dataset.parse/rows-&gt;dataset</a> - Given  a sequence of string[] rows, parse data into a dataset. Uses subset of the -&gt;dataset  options.</li>
</ul>
<h2><a href="#accessing-values" name="accessing-values"></a>Accessing Values</h2>
<ul>
  <li>Datasets overload Ifn so are functions of their column names. <code>(ds :colname)</code> will  return the column named <code>:colname</code>. Datasets implement <code>IPersistentMap</code> so  <code>(map (comp second meta) ds)</code> or <code>(map meta (vals ds))</code> will return a sequence of column  metadata. <code>keys</code>, <code>vals</code>, <code>contains?</code>, <code>assoc</code>, <code>dissoc</code>, <code>merge</code> and map-style destructuring  all work on datasets.</li>
  <li>Columns are iterable and implement indexed so you can use them with <code>map</code>, <code>count</code>  and <code>nth</code> and overload IFn such that they are functions of their indexes similar  to persistent vectors.</li>
  <li>Typed random access is supported the <code>(tech.v3.datatype/-&gt;reader col)</code>  transformation. This is guaranteed to return an implementation of <code>java.util.List</code>  and also overloads <code>IFn</code> such that like a persistent vector passing in the index  will return the value - e.g. <code>(col 0)</code> returns the value at index 0. Direct access  to packed datetime columns may be surprising; call <code>tech.v3.datatype.datetime/unpack</code>  on the column prior to calling <code>tech.v3.datatype/-&gt;reader</code> to get to the unpacked  datatype.</li>
  <li><a href="https://github.com/techascent/tech.ml.dataset/blob/7c8c7514e0e35995050c1e326122a1826cc18273/src/tech/v3/dataset/base.clj#L48">row-count</a> - works on datasets and columns.</li>
  <li><a href="https://github.com/techascent/tech.ml.dataset/blob/7c8c7514e0e35995050c1e326122a1826cc18273/src/tech/v3/dataset/base.clj#L55">column-count</a>.</li>
  <li><a href="https://github.com/techascent/tech.ml.dataset/blob/7c8c7514e0e35995050c1e326122a1826cc18273/src/tech/v3/dataset/readers.clj#L39">mapseq-reader</a> - get the rows of the  dataset as a <code>java.util.List</code> of persistent-map-like maps. Implemented as a flyweight  implementation of <code>clojure.lang.APersistentMap</code>. This keeps the data in the backing  store and lazily reads it so you will have relatively more expensive reading of the  data but will not increase your memory working-set size.</li>
  <li><a href="https://github.com/techascent/tech.ml.dataset/blob/7c8c7514e0e35995050c1e326122a1826cc18273/src/tech/v3/dataset/readers.clj#L21">value-reader</a> - Get the rows of the  dataset as a ‘java.util.List’ of rows. These rows behave like persistent vectors  but are not safe to use as keys in maps - use <code>vec</code> and get real persistent vectors if  you intend to call equals or hashCode on these.</li>
  <li><a href="https://github.com/techascent/tech.ml.dataset/blob/7c8c7514e0e35995050c1e326122a1826cc18273/src/tech/v3/dataset/base.clj#L265">missing</a> - return a RoaringBitmap of missing indexes. If this is a column, it is the column’s specific missing indexes. If this is a dataset, return a union of all the columns’ missing indexes.</li>
  <li><a href="https://github.com/techascent/tech.ml.dataset/blob/7c8c7514e0e35995050c1e326122a1826cc18273/src/tech/v3/dataset/base.clj#L85">columns-with-missing-seq</a></li>
  <li><a href="https://github.com/clojure/clojure/blob/master/src/clj/clojure/core.clj#L202">meta, with-meta, vary-meta</a> - Datasets and columns implement  <code>clojure.lang.IObj</code> so you can get/set metadata on them freely. <code>:name</code> has meaning in the system and setting it  directly on a column is not recommended. Metadata is generally carried forward through most of the operations below.</li>
</ul>
<p><code>mapseq-reader</code> and <code>value-reader</code> are lazy and thus <code>(rand-nth (mapseq-reader ds))</code> is a relatively efficient pathway (and fun). <code>(ds/mapseq-reader (ds/sample ds))</code> is also pretty good for quick scans.</p>
<h2><a href="#print-options" name="print-options"></a>Print Options</h2>
<p>We use these options frequently during exploration to get more/less printing output. These are used like <code>(vary-meta ds assoc :print-column-max-width 10)</code>. Often it is useful to print the entire table: <code>(vary-meta ds assoc :print-index-range :all)</code></p>
<ul>
  <li><a href="https://github.com/techascent/tech.ml.dataset/blob/7c8c7514e0e35995050c1e326122a1826cc18273/src/tech/v3/dataset/print.clj#L93">print metadata options</a></li>
</ul>
<h2><a href="#dataset-exploration" name="dataset-exploration"></a>Dataset Exploration</h2>
<ul>
  <li><a href="https://github.com/techascent/tech.ml.dataset/blob/7c8c7514e0e35995050c1e326122a1826cc18273/src/tech/v3/dataset.clj#L129">head</a></li>
  <li><a href="https://github.com/techascent/tech.ml.dataset/blob/7c8c7514e0e35995050c1e326122a1826cc18273/src/tech/v3/dataset.clj#L140">tail</a></li>
  <li><a href="https://github.com/techascent/tech.ml.dataset/blob/7c8c7514e0e35995050c1e326122a1826cc18273/src/tech/v3/dataset.clj#L158">sample</a></li>
  <li><a href="https://github.com/techascent/tech.ml.dataset/blob/7c8c7514e0e35995050c1e326122a1826cc18273/src/tech/v3/dataset.clj#L174">rand-nth</a></li>
  <li><a href="https://github.com/techascent/tech.ml.dataset/blob/7c8c7514e0e35995050c1e326122a1826cc18273/src/tech/v3/dataset.clj#L623">descriptive-stats</a> - return a dataset of  columnwise descriptive statistics.</li>
  <li><a href="https://github.com/techascent/tech.ml.dataset/blob/7c8c7514e0e35995050c1e326122a1826cc18273/src/tech/v3/dataset.clj#L695">brief</a> - Return a sequence of maps of descriptive statistics.</li>
</ul>
<h2><a href="#subrect-selection" name="subrect-selection"></a>Subrect Selection</h2>
<p>Keeping in mind that assoc, dissoc, and merge all work at the dataset level - here are some other pathways that are useful for subrect selection.</p>
<ul>
  <li><a href="https://github.com/techascent/tech.ml.dataset/blob/7c8c7514e0e35995050c1e326122a1826cc18273/src/tech/v3/dataset/base.clj#L178">select</a> - can be used for renaming.  Anything iterable can be used for the rows.</li>
  <li><a href="https://github.com/techascent/tech.ml.dataset/blob/7c8c7514e0e35995050c1e326122a1826cc18273/src/tech/v3/dataset/base.clj#L219">select-columns</a>.</li>
  <li><a href="https://github.com/techascent/tech.ml.dataset/blob/7c8c7514e0e35995050c1e326122a1826cc18273/src/tech/v3/dataset/base.clj#L237">select-rows</a> - works on datasets and columns.</li>
  <li><a href="https://github.com/techascent/tech.ml.dataset/blob/7c8c7514e0e35995050c1e326122a1826cc18273/src/tech/v3/dataset/base.clj#L245">drop-rows</a> - works on datasets and columns.</li>
  <li><a href="https://github.com/techascent/tech.ml.dataset/blob/7c8c7514e0e35995050c1e326122a1826cc18273/src/tech/v3/dataset/base.clj#L275">drop-missing</a></li>
</ul>
<h2><a href="#dataset-manipulation" name="dataset-manipulation"></a>Dataset Manipulation</h2>
<p>Several of the functions below come in <code>-&gt;column</code> variants and some come additional in <code>-&gt;indexes</code> variants. <code>-&gt;column</code> variants are going to be faster than the base versions and <code>-&gt;indexes</code> simply return indexes and thus skip creating sub-datasets so these are faster yet.</p>
<ul>
  <li><a href="https://github.com/techascent/tech.ml.dataset/blob/7c8c7514e0e35995050c1e326122a1826cc18273/src/tech/v3/dataset/impl/dataset.clj#L380">new-dataset</a> - Create a new dataset from a sequence of columns. Columns may be actual columns created via <code>tech.ml.dataset.column/new-column</code> or they could be maps containing at least keys <code>{:name :data}</code> but also potentially <code>{:metadata :missing}</code> in order to create a column with a specific set of missing values and metadata. <code>:force-datatype true</code> will disable the system from attempting to scan the data for missing values and e.g. create a float column from a vector of Float objects.</li>
  <li><a href="https://github.com/techascent/tech.ml.dataset/blob/7c8c7514e0e35995050c1e326122a1826cc18273/src/tech/v3/dataset/base.clj#L353">group-by-column</a>, <a href="https://github.com/techascent/tech.ml.dataset/blob/7c8c7514e0e35995050c1e326122a1826cc18273/src/tech/v3/dataset/base.clj#L335">group-by</a> - Create a persistent map of value-&gt;dataset. Sub-datasets are created via indexing into the original dataset so data is not copied.</li>
  <li><a href="https://github.com/techascent/tech.ml.dataset/blob/7c8c7514e0e35995050c1e326122a1826cc18273/src/tech/v3/dataset/base.clj#L374">sort-by-column</a>, <a href="https://github.com/techascent/tech.ml.dataset/blob/7c8c7514e0e35995050c1e326122a1826cc18273/src/tech/v3/dataset/base.clj#L363">sort-by</a> - Return a sorted dataset.</li>
  <li><a href="https://github.com/techascent/tech.ml.dataset/blob/7c8c7514e0e35995050c1e326122a1826cc18273/src/tech/v3/dataset/base.clj#L304">filter-column</a>, <a href="https://github.com/techascent/tech.ml.dataset/blob/7c8c7514e0e35995050c1e326122a1826cc18273/src/tech/v3/dataset/base.clj#L295">filter</a> - Return a new dataset with only rows that pass the predicate.</li>
  <li><a href="https://github.com/techascent/tech.ml.dataset/blob/7c8c7514e0e35995050c1e326122a1826cc18273/src/tech/v3/dataset.clj#L346">column-cast</a> - Change the datatype of a column.</li>
  <li><a href="https://github.com/techascent/tech.ml.dataset/blob/7c8c7514e0e35995050c1e326122a1826cc18273/src/tech/v3/dataset/base.clj#L450">concat-copying</a>, <a href="https://github.com/techascent/tech.ml.dataset/blob/7c8c7514e0e35995050c1e326122a1826cc18273/src/tech/v3/dataset/base.clj#L442">concat-inplace</a> - Given Y datasets produce a new dataset. Whether to do in-place or copying concatenation depends roughly on the number of datasets. Inplace works best with under 5 datasets where all datasets have an identical row count. Copying can increase your ram usage but returns a dataset that will be more efficient to iterate over later. <code>(apply ds/concat-copying x-seq)</code> is <strong>far</strong> more efficient than <code>(reduce ds/concat-copying x-seq)</code>; this also is true for <code>concat-inplace</code>.</li>
  <li><a href="https://github.com/techascent/tech.ml.dataset/blob/7c8c7514e0e35995050c1e326122a1826cc18273/src/tech/v3/dataset/base.clj#L498">unique-by-column</a>, <a href="https://github.com/techascent/tech.ml.dataset/blob/7c8c7514e0e35995050c1e326122a1826cc18273/src/tech/v3/dataset/base.clj#L481">unique-by</a> - Remove duplicate rows. Passing in <code>keep-fn</code> allows you to choose either first, last, or some other criteria for rows that have the same values.</li>
  <li><a href="https://github.com/techascent/tech.ml.dataset/blob/7c8c7514e0e35995050c1e326122a1826cc18273/src/tech/v3/dataset.clj#L437">columnwise-concat</a> - Concatenate columns into longer dataset repeating values in other columns.</li>
</ul>
<h2><a href="#elementwise-arithmetic" name="elementwise-arithmetic"></a>Elementwise Arithmetic</h2>
<p>Functions in ‘tech.v3.datatype.functional’ all will apply various elementwise arithmetic operations to a column lazily returning a new column.</p>
<pre><code class="clojure">       (assoc ds :value (dtype/elemwise-cast (ds :value) :int64)
                 :shrs-or-prn-amt (dtype/elemwise-cast (ds :shrs-or-prn-amt) :int64)
                 :cik (dtype/const-reader (:cik filing) (ds/row-count ds))
                 :investor (dtype/const-reader investor (ds/row-count ds))
                 :form-type (dtype/const-reader form-type (ds/row-count ds))
                 :edgar-id (dtype/const-reader (:edgar-id filing) (ds/row-count ds))
                 :weight (dfn// (ds :value)
                                (double (dfn/reduce-+ (ds :value)))))
</code></pre>
<h2><a href="#forcing-lazy-evaluation" name="forcing-lazy-evaluation"></a>Forcing Lazy Evaluation</h2>
<p>The dataset system relies on index indirection and laziness quite often. This allows  you to aggregate up operations and pay relatively little for them however sometimes  it increases the accessing costs of the data by an undesirable amount. Because  of this we use <code>clone</code> quite often to force calculations to complete before  beginning a new stage of data processing. Clone is multithreaded and very efficient  often boiling down into either parallelized iteration over the data or  <code>System/arraycopy</code> calls.</p>
<p>Additionally calling ‘clone’ after loading will reduce the in-memory size of the  dataset by a bit - sometimes 20%. This is because lists that have allocated extra  capacity are copied into arrays that have no extra capacity.</p>
<ul>
  <li><a href="https://github.com/cnuernber/dtype-next/blob/152f09f925041d41782e05009bbf84d7d6cfdbc6/src/tech/v3/datatype.clj#L95">tech.v3.datatype/clone</a> - Clones the dataset realizing lazy operation and copying the data into  java arrays. Will clone datasets or columns.</li>
</ul></div></div></div></body></html>