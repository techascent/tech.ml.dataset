<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>tech.v3.dataset.reductions documentation</title><script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-RGTB4J7LGP"></script><script>window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-RGTB4J7LGP');</script><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="highlight/solarized-light.css" /><script type="text/javascript" src="highlight/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a> with <a href="https://github.com/xsc/codox-theme-rdash">RDash UI</a> theme</h2><h1><a href="index.html"><span class="project-title"><span class="project-name">tech.ml.dataset</span> <span class="project-version">6.088</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1 "><a href="columns-readers-and-datatypes.html"><div class="inner"><span>tech.ml.dataset Columns, Readers, and Datatypes</span></div></a></li><li class="depth-1 "><a href="nippy-serialization-rocks.html"><div class="inner"><span>tech.ml.dataset And nippy</span></div></a></li><li class="depth-1 "><a href="quick-reference.html"><div class="inner"><span>tech.ml.dataset Quick Reference</span></div></a></li><li class="depth-1 "><a href="supported-datatypes.html"><div class="inner"><span>tech.ml.dataset Supported Datatypes</span></div></a></li><li class="depth-1 "><a href="walkthrough.html"><div class="inner"><span>tech.ml.dataset Walkthrough</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>tech</span></div></div></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>v3</span></div></div></li><li class="depth-3"><a href="tech.v3.dataset.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>dataset</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.dataset.categorical.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>categorical</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.dataset.clipboard.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>clipboard</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.dataset.column.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>column</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.dataset.column-filters.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>column-filters</span></div></a></li><li class="depth-4"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>io</span></div></div></li><li class="depth-5 branch"><a href="tech.v3.dataset.io.csv.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>csv</span></div></a></li><li class="depth-5 branch"><a href="tech.v3.dataset.io.datetime.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>datetime</span></div></a></li><li class="depth-5 branch"><a href="tech.v3.dataset.io.string-row-parser.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>string-row-parser</span></div></a></li><li class="depth-5"><a href="tech.v3.dataset.io.univocity.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>univocity</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.dataset.join.html"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>join</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.dataset.math.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>math</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.dataset.metamorph.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>metamorph</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.dataset.modelling.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>modelling</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.dataset.neanderthal.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>neanderthal</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.dataset.print.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>print</span></div></a></li><li class="depth-4 current"><a href="tech.v3.dataset.reductions.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>reductions</span></div></a></li><li class="depth-5"><a href="tech.v3.dataset.reductions.apache-data-sketch.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>apache-data-sketch</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.dataset.rolling.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>rolling</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.dataset.tensor.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>tensor</span></div></a></li><li class="depth-4"><a href="tech.v3.dataset.zip.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>zip</span></div></a></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree" style="top: -641px;"><span class="top" style="height: 650px;"></span><span class="bottom"></span></span><span>libs</span></div></div></li><li class="depth-4 branch"><a href="tech.v3.libs.arrow.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>arrow</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.libs.fastexcel.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>fastexcel</span></div></a></li><li class="depth-4"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>guava</span></div></div></li><li class="depth-5"><a href="tech.v3.libs.guava.cache.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>cache</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.libs.parquet.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>parquet</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.libs.poi.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>poi</span></div></a></li><li class="depth-4"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>smile</span></div></div></li><li class="depth-5"><a href="tech.v3.libs.smile.data.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>data</span></div></a></li><li class="depth-4"><a href="tech.v3.libs.tribuo.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>tribuo</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="tech.v3.dataset.reductions.html#var-aggregate"><div class="inner"><span>aggregate</span></div></a></li><li class="depth-1"><a href="tech.v3.dataset.reductions.html#var-count-distinct"><div class="inner"><span>count-distinct</span></div></a></li><li class="depth-1"><a href="tech.v3.dataset.reductions.html#var-distinct"><div class="inner"><span>distinct</span></div></a></li><li class="depth-1"><a href="tech.v3.dataset.reductions.html#var-distinct-int32"><div class="inner"><span>distinct-int32</span></div></a></li><li class="depth-1"><a href="tech.v3.dataset.reductions.html#var-first-value"><div class="inner"><span>first-value</span></div></a></li><li class="depth-1"><a href="tech.v3.dataset.reductions.html#var-group-by-column-agg"><div class="inner"><span>group-by-column-agg</span></div></a></li><li class="depth-1"><a href="tech.v3.dataset.reductions.html#var-index-reducer"><div class="inner"><span>index-reducer</span></div></a></li><li class="depth-1"><a href="tech.v3.dataset.reductions.html#var-mean"><div class="inner"><span>mean</span></div></a></li><li class="depth-1"><a href="tech.v3.dataset.reductions.html#var-prob-cdf"><div class="inner"><span>prob-cdf</span></div></a></li><li class="depth-1"><a href="tech.v3.dataset.reductions.html#var-prob-interquartile-range"><div class="inner"><span>prob-interquartile-range</span></div></a></li><li class="depth-1"><a href="tech.v3.dataset.reductions.html#var-prob-median"><div class="inner"><span>prob-median</span></div></a></li><li class="depth-1"><a href="tech.v3.dataset.reductions.html#var-prob-quantile"><div class="inner"><span>prob-quantile</span></div></a></li><li class="depth-1"><a href="tech.v3.dataset.reductions.html#var-reducer"><div class="inner"><span>reducer</span></div></a></li><li class="depth-1"><a href="tech.v3.dataset.reductions.html#var-reservoir-dataset"><div class="inner"><span>reservoir-dataset</span></div></a></li><li class="depth-1"><a href="tech.v3.dataset.reductions.html#var-reservoir-desc-stat"><div class="inner"><span>reservoir-desc-stat</span></div></a></li><li class="depth-1"><a href="tech.v3.dataset.reductions.html#var-row-count"><div class="inner"><span>row-count</span></div></a></li><li class="depth-1"><a href="tech.v3.dataset.reductions.html#var-sum"><div class="inner"><span>sum</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">tech.v3.dataset.reductions</h1><div class="doc"><div class="markdown"><p>Specific high performance reductions intended to be performend over a sequence
of datasets.  This allows aggregations to be done in situations where the dataset is
larger than what will fit in memory on a normal machine.  Due to this fact, summation
is implemented using Kahan algorithm and various statistical methods are done in using
statistical estimation techniques and thus are prefixed with <code>prob-</code> which is short
for <code>probabilistic</code>.</p>
<ul>
<li><code>aggregate</code> - Perform a multi-dataset aggregation. Returns a dataset with row.</li>
<li><code>group-by-column-agg</code> - Perform a multi-dataset group-by followed by
an aggregation.  Returns a dataset with one row per key.</li>
</ul>
<p>Examples:</p>
<pre><code class="language-clojure">user&gt; (require '[tech.v3.dataset :as ds])
nil
user&gt; (require '[tech.v3.datatype.datetime :as dtype-dt])
nil
user&gt; (def stocks (-&gt; (ds/-&gt;dataset "test/data/stocks.csv" {:key-fn keyword})
                      (ds/update-column :date #(dtype-dt/datetime-&gt;epoch :epoch-days %))))
#'user/stocks
user&gt; (require '[tech.v3.dataset.reductions :as ds-reduce])
nil
user&gt; (ds-reduce/group-by-column-agg
       :symbol
       {:symbol (ds-reduce/first-value :symbol)
        :price-avg (ds-reduce/mean :price)
        :price-sum (ds-reduce/sum :price)
        :price-med (ds-reduce/prob-median :price)}
       (repeat 3 stocks))
:symbol-aggregation [5 4]:

| :symbol |   :price-avg | :price-sum |   :price-med |
|---------|--------------|------------|--------------|
|     IBM |  91.26121951 |   33675.39 |  88.70468750 |
|    AAPL |  64.73048780 |   23885.55 |  37.05281250 |
|    MSFT |  24.73674797 |    9127.86 |  24.07277778 |
|    AMZN |  47.98707317 |   17707.23 |  41.35142361 |
|    GOOG | 415.87044118 |   84837.57 | 422.69722222 |
</code></pre>
<ul>
<li><a href="https://github.com/zero-one-group/geni-performance-benchmark/blob/da4d02e54de25a72214f72c4864ebd3d307520f8/dataset/src/dataset/optimised_by_chris.clj">zero-one benchmark winner</a></li>
</ul>
</div></div><div class="public anchor" id="var-aggregate"><h3>aggregate</h3><div class="usage"><code>(aggregate agg-map options ds-seq)</code><code>(aggregate agg-map ds-seq)</code></div><div class="doc"><div class="markdown"><p>Create a set of aggregate statistics over a sequence of datasets.  Returns a
dataset with a single row and uses the same interface group-by-column-agg.</p>
<p>Example:</p>
<pre><code class="language-clojure">  (ds-reduce/aggregate
   {:n-elems (ds-reduce/row-count)
    :price-avg (ds-reduce/mean :price)
    :price-sum (ds-reduce/sum :price)
    :price-med (ds-reduce/prob-median :price)
    :price-iqr (ds-reduce/prob-interquartile-range :price)
    :n-dates (ds-reduce/count-distinct :date :int32)}
   ds-seq])
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/techascent/tech.ml.dataset/blob/master/src/tech/v3/dataset/reductions.clj#L515">view source</a></div></div><div class="public anchor" id="var-count-distinct"><h3>count-distinct</h3><div class="usage"><code>(count-distinct colname op-space)</code><code>(count-distinct colname)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/techascent/tech.ml.dataset/blob/master/src/tech/v3/dataset/reductions.clj#L158">view source</a></div></div><div class="public anchor" id="var-distinct"><h3>distinct</h3><div class="usage"><code>(distinct colname finalizer)</code><code>(distinct colname)</code></div><div class="doc"><div class="markdown"><p>Create a reducer that will return a set of values.</p>
</div></div><div class="src-link"><a href="https://github.com/techascent/tech.ml.dataset/blob/master/src/tech/v3/dataset/reductions.clj#L148">view source</a></div></div><div class="public anchor" id="var-distinct-int32"><h3>distinct-int32</h3><div class="usage"><code>(distinct-int32 colname finalizer)</code><code>(distinct-int32 colname)</code></div><div class="doc"><div class="markdown"><p>Get the set of distinct items given you know the space is no larger than int32
space.  The optional finalizer allows you to post-process the data.</p>
</div></div><div class="src-link"><a href="https://github.com/techascent/tech.ml.dataset/blob/master/src/tech/v3/dataset/reductions.clj#L125">view source</a></div></div><div class="public anchor" id="var-first-value"><h3>first-value</h3><div class="usage"><code>(first-value colname)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/techascent/tech.ml.dataset/blob/master/src/tech/v3/dataset/reductions.clj#L76">view source</a></div></div><div class="public anchor" id="var-group-by-column-agg"><h3>group-by-column-agg</h3><div class="usage"><code>(group-by-column-agg colname agg-map options ds-seq)</code><code>(group-by-column-agg colname agg-map ds-seq)</code></div><div class="doc"><div class="markdown"><p>Group a sequence of datasets by a column and aggregate down into a new dataset.</p>
<ul>
<li>
<p>colname - Either a single scalar column name or a vector of column names to group by.</p>
</li>
<li>
<p>agg-map - map of result column name to reducer.  All values in the agg map must be
instances of <code>tech.v3.datatype.IndexReduction</code>.  Column values will be inferred from
the finalized result of the first reduction with nil indicating an object column.</p>
</li>
</ul>
<p>Options:</p>
<ul>
<li><code>:map-initial-capacity</code> - initial hashmap capacity.  Resizing hash-maps is expensive so we
would like to set this to something reasonable.  Defaults to 100000.</li>
<li><code>:index-filter</code> - A function that given a dataset produces a function from long index
to boolean.  Only indexes for which the index-filter returns true will be added to the
aggregation.  For very large datasets, this is a bit faster than using filter before
the aggregation.</li>
</ul>
<p>Example:</p>
<pre><code class="language-clojure">user&gt; (require '[tech.v3.dataset :as ds])
nil
user&gt; (require '[tech.v3.dataset.reductions :as ds-reduce])
nil
user&gt; (def stocks (ds/-&gt;dataset "test/data/stocks.csv" {:key-fn keyword}))
#'user/stocks
user&gt; (ds-reduce/group-by-column-agg
       :symbol
       {:symbol (ds-reduce/first-value :symbol)
        :price-avg (ds-reduce/mean :price)
        :price-sum (ds-reduce/sum :price)}
       [stocks stocks stocks])
:symbol-aggregation [5 3]:

| :symbol |   :price-avg | :price-sum |
|---------|--------------|------------|
|    MSFT |  24.73674797 |    9127.86 |
|     IBM |  91.26121951 |   33675.39 |
|    AAPL |  64.73048780 |   23885.55 |
|    GOOG | 415.87044118 |   84837.57 |
|    AMZN |  47.98707317 |   17707.23 |



tech.v3.dataset.reductions-test&gt; (def tstds
                                   (ds/-&gt;dataset {:a ["a" "a" "a" "b" "b" "b" "c" "d" "e"]
                                                  :b [22   21  22 44  42  44   77 88 99]}))
#'tech.v3.dataset.reductions-test/tstds
tech.v3.dataset.reductions-test&gt;  (ds-reduce/group-by-column-agg
                                   [:a :b] {:a (ds-reduce/first-value :a)
                                            :b (ds-reduce/first-value :b)
                                            :c (ds-reduce/row-count)}
                                   [tstds tstds tstds])
:tech.v3.dataset.reductions/_temp_col-aggregation [7 3]:

| :a | :b | :c |
|----|---:|---:|
|  a | 21 |  3 |
|  a | 22 |  6 |
|  b | 42 |  3 |
|  b | 44 |  6 |
|  c | 77 |  3 |
|  d | 88 |  3 |
|  e | 99 |  3 |
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/techascent/tech.ml.dataset/blob/master/src/tech/v3/dataset/reductions.clj#L363">view source</a></div></div><div class="public anchor" id="var-index-reducer"><h3>index-reducer</h3><div class="usage"><code>(index-reducer per-idx-fn {:keys [per-batch-fn merge-fn finalize-fn], :or {per-batch-fn identity, merge-fn (fn* [] (throw (Exception. "Merge function not defined for reducer"))), finalize-fn identity}})</code><code>(index-reducer per-idx-fn)</code></div><div class="doc"><div class="markdown"><p>Define an indexed reducer which is used as the values in the group-by-agg and aggregate
reduction maps.</p>
<ul>
<li><code>per-idx-fn</code> - This gets passed three arguments - the batch-ctx which defaults to
the current dataset, the reduction context, and the row index.  It is expected to
return a new reduction context.  The first time this is called for a given reduction
bucket, the reduction context will be nil.</li>
</ul>
<p>Options:</p>
<ul>
<li><code>:per-batch-fn</code> - This is called once per dataset and the return value of this is passed
as the first argument to <code>per-idx-fn</code>.</li>
<li><code>:merge-fn</code> - For reductions are done with per-thread contexts, the final step is to merge
the per-thread contexts back into one final context.  This is <strong>not</strong> currently used for
<code>group-by-agg</code> but it is used for <code>aggregate</code>.</li>
<li><code>:finalize</code> - Optional argument to perform a final pass on the result of the reduction
before it is set as the row value for the column.</li>
</ul>
<p>Example:</p>
<pre><code class="language-clojure">user&gt; (def stocks (ds/-&gt;dataset "test/data/stocks.csv"))
#'user/stocks
user&gt; (ds-reduce/group-by-column-agg
       "symbol"
       {:symbol (ds-reduce/first-value "symbol")
        :price-sum (ds-reduce/index-reducer
                    (fn [ds obj-ctx ^long row-idx]
                      (+ (or obj-ctx 0.0)
                         ((ds "price") row-idx))))}
       [stocks])
symbol-aggregation [5 2]:

| :symbol | :price-sum |
|---------|-----------:|
|    AAPL |    7961.85 |
|     IBM |   11225.13 |
|    AMZN |    5902.41 |
|    MSFT |    3042.62 |
|    GOOG |   28279.19 |
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/techascent/tech.ml.dataset/blob/master/src/tech/v3/dataset/reductions.clj#L559">view source</a></div></div><div class="public anchor" id="var-mean"><h3>mean</h3><div class="usage"><code>(mean colname)</code></div><div class="doc"><div class="markdown"><p>Create a double consumer which will produce a mean of the column.</p>
</div></div><div class="src-link"><a href="https://github.com/techascent/tech.ml.dataset/blob/master/src/tech/v3/dataset/reductions.clj#L95">view source</a></div></div><div class="public anchor" id="var-prob-cdf"><h3>prob-cdf</h3><div class="usage"><code>(prob-cdf colname cdf compression)</code><code>(prob-cdf colname cdf)</code></div><div class="doc"><div class="markdown"><p>Probabilistic CDF using using tdunning/TDigest. Returns the fraction of all
points added which are <code>&lt;= cdf</code>.</p>
<ul>
<li><code>colname</code> - Column to run algorithm</li>
<li><code>cdf</code> - cdf</li>
<li><code>compression</code> - The compression parameter.  100 is a common value for normal uses.
1000 is extremely large. The number of centroids retained will be a smallish (usually
less than 10) multiple of this number.</li>
</ul>
</div></div><div class="src-link"><a href="https://github.com/techascent/tech.ml.dataset/blob/master/src/tech/v3/dataset/reductions.clj#L209">view source</a></div></div><div class="public anchor" id="var-prob-interquartile-range"><h3>prob-interquartile-range</h3><div class="usage"><code>(prob-interquartile-range colname compression)</code><code>(prob-interquartile-range colname)</code></div><div class="doc"><div class="markdown"><p>Probabilistic interquartile range using tdunning/TDigest.  The interquartile
range is defined as <code>(- (quartile 0.75) (quartile 0.25)).</code></p>
<p>See <code>prob-quartile</code>.</p>
</div></div><div class="src-link"><a href="https://github.com/techascent/tech.ml.dataset/blob/master/src/tech/v3/dataset/reductions.clj#L248">view source</a></div></div><div class="public anchor" id="var-prob-median"><h3>prob-median</h3><div class="usage"><code>(prob-median colname compression)</code><code>(prob-median colname)</code></div><div class="doc"><div class="markdown"><p>Probabilistic median using Use tdunning/TDigest.  See <code>prob-quartile</code>.</p>
</div></div><div class="src-link"><a href="https://github.com/techascent/tech.ml.dataset/blob/master/src/tech/v3/dataset/reductions.clj#L241">view source</a></div></div><div class="public anchor" id="var-prob-quantile"><h3>prob-quantile</h3><div class="usage"><code>(prob-quantile colname quantile compression)</code><code>(prob-quantile colname quantile)</code></div><div class="doc"><div class="markdown"><p>Probabilistic quantile using tdunning/TDigest. Returns an estimate of the cutoff
such that a specified fraction of the data added to this TDigest would be less
than or equal to the cutoff.</p>
<ul>
<li><code>colname</code> - Column to run algorithm</li>
<li><code>quantile</code> - Specified fraction from 0.0-1.0.  0.5 returns the median.</li>
<li><code>compression</code> - The compression parameter.  100 is a common value for normal uses.
1000 is extremely large. The number of centroids retained will be a smallish (usually
less than 10) multiple of this number.</li>
</ul>
</div></div><div class="src-link"><a href="https://github.com/techascent/tech.ml.dataset/blob/master/src/tech/v3/dataset/reductions.clj#L225">view source</a></div></div><div class="public anchor" id="var-reducer"><h3>reducer</h3><div class="usage"><code>(reducer column-name per-elem-fn finalize-fn)</code><code>(reducer column-name per-elem-fn)</code></div><div class="doc"><div class="markdown"><p>Make a group-by-agg reducer.</p>
<ul>
<li><code>column-name</code> - Single column name or multiple columns.</li>
<li><code>per-elem-fn</code> - Called with the context as the first arg and each column's data
as further arguments.</li>
<li><code>finalize-fn</code> - finalize the result after aggregation.  Optional, will be replaced
with identity of not provided.</li>
</ul>
</div></div><div class="src-link"><a href="https://github.com/techascent/tech.ml.dataset/blob/master/src/tech/v3/dataset/reductions.clj#L289">view source</a></div></div><div class="public anchor" id="var-reservoir-dataset"><h3>reservoir-dataset</h3><div class="usage"><code>(reservoir-dataset reservoir-size colnames options)</code><code>(reservoir-dataset reservoir-size colnames)</code><code>(reservoir-dataset reservoir-size)</code></div><div class="doc"><div class="markdown"><p>Create a new dataset consisting of these column names (or all the column names of
the first dataset in the sequence).  New dataset will have at most reservoir-size
rows.  There must be enough memory for N datasets during parallelized reduction
step where N is at least n-cores or n-keys in the group-by map.</p>
<p>Options are options for <a href="https://cnuernber.github.io/dtype-next/tech.v3.datatype.sampling.html#var-double-reservoir">double-reservoir</a>.</p>
<p>Example:</p>
<pre><code class="language-clojure">tech.v3.dataset.reductions&gt; (group-by-column-agg
                             :symbol
                             {:symbol (first-value :symbol)
                              :n-elems (row-count)
                              :price-med (prob-median :price)
                              :stddev (reservoir-desc-stat :price 100 :standard-deviation)
                              :sub-stocks (reservoir-dataset 5)}
                             [stocks stocks stocks])
:symbol-aggregation [5 5]:

| :symbol | :n-elems |   :price-med |      :stddev |                         :sub-stocks |
|---------|----------|--------------|--------------|-------------------------------------|
|     IBM |      369 |  88.70468750 |  16.29366714 | _unnamed [5 3]:                     |
|         |          |              |              |                                     |
|         |          |              |              | \| :symbol \|   :date \|  :price \| |
|         |          |              |              | \|---------\|---------\|---------\| |
|         |          |              |              | \|     IBM \|   11992 \|   79.16 \| |
|         |          |              |              | \|     IBM \|   12022 \|   70.58 \| |
|         |          |              |              | \|     IBM \|   14610 \|   121.9 \| |
|         |          |              |              | \|     IBM \|   14214 \|   82.15 \| |
|         |          |              |              | \|     IBM \|   11292 \|   76.47 \| |
|    MSFT |      369 |  24.07277778 |   4.20544368 | _unnamed [5 3]:                     |
|         |          |              |              |                                     |
|         |          |              |              | \| :symbol \|   :date \|  :price \| |
|         |          |              |              | \|---------\|---------\|---------\| |
|         |          |              |              | \|    MSFT \|   12904 \|   23.82 \| |
|         |          |              |              | \|    MSFT \|   13604 \|   28.30 \| |
|         |          |              |              | \|    MSFT \|   12874 \|   23.28 \| |
|         |          |              |              | \|    MSFT \|   14610 \|   28.05 \| |
|         |          |              |              | \|    MSFT \|   12753 \|   24.52 \| |
|    AAPL |      369 |  37.05281250 |  61.61364337 | _unnamed [5 3]:                     |
|         |          |              |              |                                     |
|         |          |              |              | \| :symbol \|   :date \|  :price \| |
|         |          |              |              | \|---------\|---------\|---------\| |
|         |          |              |              | \|    AAPL \|   11566 \|   7.760 \| |
|         |          |              |              | \|    AAPL \|   14641 \|   204.6 \| |
|         |          |              |              | \|    AAPL \|   12173 \|   8.980 \| |
|         |          |              |              | \|    AAPL \|   14276 \|   89.31 \| |
|         |          |              |              | \|    AAPL \|   11869 \|   7.630 \| |
|    AMZN |      369 |  41.35142361 |  26.92738019 | _unnamed [5 3]:                     |
|         |          |              |              |                                     |
|         |          |              |              | \| :symbol \|   :date \|  :price \| |
|         |          |              |              | \|---------\|---------\|---------\| |
|         |          |              |              | \|    AMZN \|   13483 \|   39.46 \| |
|         |          |              |              | \|    AMZN \|   12570 \|   54.40 \| |
|         |          |              |              | \|    AMZN \|   14641 \|   118.4 \| |
|         |          |              |              | \|    AMZN \|   12935 \|   33.09 \| |
|         |          |              |              | \|    AMZN \|   11992 \|   23.35 \| |
|    GOOG |      204 | 422.69722222 | 132.23132957 | _unnamed [5 3]:                     |
|         |          |              |              |                                     |
|         |          |              |              | \| :symbol \|   :date \|  :price \| |
|         |          |              |              | \|---------\|---------\|---------\| |
|         |          |              |              | \|    GOOG \|   13787 \|   707.0 \| |
|         |          |              |              | \|    GOOG \|   14153 \|   359.4 \| |
|         |          |              |              | \|    GOOG \|   13634 \|   497.9 \| |
|         |          |              |              | \|    GOOG \|   12935 \|   294.2 \| |
|         |          |              |              | \|    GOOG \|   13269 \|   371.8 \| |
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/techascent/tech.ml.dataset/blob/master/src/tech/v3/dataset/reductions/impl.clj#L292">view source</a></div></div><div class="public anchor" id="var-reservoir-desc-stat"><h3>reservoir-desc-stat</h3><div class="usage"><code>(reservoir-desc-stat colname reservoir-size stat-name options)</code><code>(reservoir-desc-stat colname reservoir-size stat-name)</code></div><div class="doc"><div class="markdown"><p>Calculate a descriptive statistic using reservoir sampling.  A list of statistic
names are found in <code>tech.v3.datatype.statistics/all-descriptive-stats-names</code>.
Options are options used in
<a href="https://cnuernber.github.io/dtype-next/tech.v3.datatype.sampling.html#var-double-reservoir">double-reservoir</a>.</p>
<p>Note that this method will <em>not</em> convert datetime objects to milliseconds for you as
in descriptive-stats.</p>
</div></div><div class="src-link"><a href="https://github.com/techascent/tech.ml.dataset/blob/master/src/tech/v3/dataset/reductions.clj#L264">view source</a></div></div><div class="public anchor" id="var-row-count"><h3>row-count</h3><div class="usage"><code>(row-count)</code></div><div class="doc"><div class="markdown"><p>Create a simple reducer that returns the number of times reduceIndex was called.</p>
</div></div><div class="src-link"><a href="https://github.com/techascent/tech.ml.dataset/blob/master/src/tech/v3/dataset/reductions.clj#L102">view source</a></div></div><div class="public anchor" id="var-sum"><h3>sum</h3><div class="usage"><code>(sum colname)</code></div><div class="doc"><div class="markdown"><p>Create a double consumer which will sum the values.</p>
</div></div><div class="src-link"><a href="https://github.com/techascent/tech.ml.dataset/blob/master/src/tech/v3/dataset/reductions.clj#L87">view source</a></div></div></div></body></html>