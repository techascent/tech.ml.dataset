<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>tech.v3.libs.parquet documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="highlight/solarized-light.css" /><script type="text/javascript" src="highlight/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a> with <a href="https://github.com/xsc/codox-theme-rdash">RDash UI</a> theme</h2><h1><a href="index.html"><span class="project-title"><span class="project-name">tech.ml.dataset</span> <span class="project-version">6.044</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1 "><a href="columns-readers-and-datatypes.html"><div class="inner"><span>Columns, Readers, and Datatypes</span></div></a></li><li class="depth-1 "><a href="nippy-serialization-rocks.html"><div class="inner"><span>Nippy Rocks!</span></div></a></li><li class="depth-1 "><a href="quick-reference.html"><div class="inner"><span>Quick Reference - Core API</span></div></a></li><li class="depth-1 "><a href="supported-datatypes.html"><div class="inner"><span>Supported Datatypes</span></div></a></li><li class="depth-1 "><a href="walkthrough.html"><div class="inner"><span>tech.ml.dataset Walkthrough</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>tech</span></div></div></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>v3</span></div></div></li><li class="depth-3"><a href="tech.v3.dataset.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>dataset</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.dataset.categorical.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>categorical</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.dataset.clipboard.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>clipboard</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.dataset.column.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>column</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.dataset.column-filters.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>column-filters</span></div></a></li><li class="depth-4"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>io</span></div></div></li><li class="depth-5 branch"><a href="tech.v3.dataset.io.datetime.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>datetime</span></div></a></li><li class="depth-5 branch"><a href="tech.v3.dataset.io.string-row-parser.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>string-row-parser</span></div></a></li><li class="depth-5"><a href="tech.v3.dataset.io.univocity.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>univocity</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.dataset.join.html"><div class="inner"><span class="tree" style="top: -114px;"><span class="top" style="height: 123px;"></span><span class="bottom"></span></span><span>join</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.dataset.math.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>math</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.dataset.metamorph.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>metamorph</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.dataset.modelling.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>modelling</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.dataset.neanderthal.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>neanderthal</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.dataset.print.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>print</span></div></a></li><li class="depth-4"><a href="tech.v3.dataset.reductions.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>reductions</span></div></a></li><li class="depth-5"><a href="tech.v3.dataset.reductions.apache-data-sketch.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>apache-data-sketch</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.dataset.rolling.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>rolling</span></div></a></li><li class="depth-4"><a href="tech.v3.dataset.tensor.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>tensor</span></div></a></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree" style="top: -579px;"><span class="top" style="height: 588px;"></span><span class="bottom"></span></span><span>libs</span></div></div></li><li class="depth-4 branch"><a href="tech.v3.libs.arrow.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>arrow</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.libs.fastexcel.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>fastexcel</span></div></a></li><li class="depth-4"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>guava</span></div></div></li><li class="depth-5"><a href="tech.v3.libs.guava.cache.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>cache</span></div></a></li><li class="depth-4 branch current"><a href="tech.v3.libs.parquet.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>parquet</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.libs.poi.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>poi</span></div></a></li><li class="depth-4"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>smile</span></div></div></li><li class="depth-5"><a href="tech.v3.libs.smile.data.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>data</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="tech.v3.libs.parquet.html#var-ds-.3Eparquet"><div class="inner"><span>ds-&gt;parquet</span></div></a></li><li class="depth-1"><a href="tech.v3.libs.parquet.html#var-ds-seq-.3Eparquet"><div class="inner"><span>ds-seq-&gt;parquet</span></div></a></li><li class="depth-1"><a href="tech.v3.libs.parquet.html#var-parquet-.3Eds-seq"><div class="inner"><span>parquet-&gt;ds-seq</span></div></a></li><li class="depth-1"><a href="tech.v3.libs.parquet.html#var-parquet-.3Emetadata-seq"><div class="inner"><span>parquet-&gt;metadata-seq</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">tech.v3.libs.parquet</h1><div class="doc"><div class="markdown"><p>Support for reading Parquet files. You must require this namespace to
enable parquet read/write support.</p>
<p>Supported datatypes:</p>
<ul>
<li>all numeric types</li>
<li>strings</li>
<li>java.time LocalDate, Instant</li>
<li>UUIDs (get read/written as strings in accordance to R's write_parquet function)</li>
</ul>
<p>Parsing parquet file options include more general io/-&gt;dataset options:</p>
<ul>
<li><code>:key-fn</code></li>
<li><code>:column-whitelist</code></li>
<li><code>:column-blacklist</code></li>
<li><code>:parser-fn</code></li>
</ul>
<p>Please include these dependencies in your project and be sure to read the notes
later in this document:</p>
<pre><code class="language-clojure">org.apache.parquet/parquet-hadoop {:mvn/version "1.12.0"
                                   :exclusions [org.slf4j/slf4j-log4j12]}
org.apache.hadoop/hadoop-common {:mvn/version "3.3.0"
                                 :exclusions [org.slf4j/slf4j-log4j12]}
;; We literally need this for 1 POJO formatting object.
org.apache.hadoop/hadoop-mapreduce-client-core {:mvn/version "3.3.0"
                                                :exclusions [org.slf4j/slf4j-log4j12]}
</code></pre>
<h4>Logging</h4>
<p>When writing parquet files you may notice a truly excessive amount of logging and/or
extremely slow write speeds.  The solution to this, if you are using
the default <code>tech.ml.dataset</code> implementation with logback-classic as the concrete
logger is to disable debug logging by placing  a file named <code>logback.xml</code>
in the classpath where the root node has a log-level above debug.  The logback.xml
file that 'tmd' uses by default during development is located in
<a href="https://github.com/techascent/tech.ml.dataset/blob/45a032768f25b1493a83e6baaff34832a184f8ab/dev-resources/logback.xml">dev-resources</a> and is
enabled via a profile in <a href="https://github.com/techascent/tech.ml.dataset/blob/45a032768f25b1493a83e6baaff34832a184f8ab/project.clj#L69">project.clj</a>.</p>
<h4>Large-ish Datasets</h4>
<p>The parquet writer will automatically split your dataset up into multiple parquet
records so it is possible that you can attempt to write one large dataset then when
you read it back you get a parquet file with multiple datasets.  This is perhaps
confusing but it is a side effect of the hadoop architecture.  The simplest solution
to this is to, when loading parquet files, use parquet-&gt;ds-seq and then a final
concat-copying operation to produce one final dataset.  <code>-&gt;dataset</code> will do
this operation for you but it will emit a warning when doing so as this may
lead to OOM situations with some parquet files.  To disable this warning use the
option <code>:disable-parquet-warn-on-multiple-datasets</code> set to truthy.</p>
</div></div><div class="public anchor" id="var-ds-.3Eparquet"><h3>ds-&gt;parquet</h3><div class="usage"><code>(ds-&gt;parquet ds path options)</code><code>(ds-&gt;parquet ds path)</code></div><div class="doc"><div class="markdown"><p>Write a dataset to a parquet file.  Many parquet options are possible;
these can also be passed in via ds/-&gt;write!</p>
<p>Options are the same as ds-seq-&gt;parquet.</p>
</div></div><div class="src-link"><a href="https://github.com/techascent/tech.ml.dataset/blob/master/src/tech/v3/libs/parquet.clj#L1021">view source</a></div></div><div class="public anchor" id="var-ds-seq-.3Eparquet"><h3>ds-seq-&gt;parquet</h3><div class="usage"><code>(ds-seq-&gt;parquet path options ds-seq)</code><code>(ds-seq-&gt;parquet path ds-seq)</code></div><div class="doc"><div class="markdown"><p>Write a sequence of datasets to a parquet file.  Parquet will break the data
stream up according to parquet file properties.</p>
<p>Options:</p>
<ul>
<li><code>:hadoop-configuration</code> - Either nil or an instance of
<code>org.apache.hadoop.conf.Configuration</code>.</li>
<li><code>:compression-codec</code> - Either nil or an instance of
<code>org.apache.parquet.hadoop.metadata.CompressionCodecName</code>.  Defaults to
<code>org.apache.parquet.column.ParquetProperties.WriterVersion</code>.</li>
<li><code>:block-size</code> - Defaults to <code>ParquetWriter/DEFAULT_BLOCK_SIZE</code>.</li>
<li><code>:page-size</code> - Defaults to <code>ParquetWriter/DEFAULT_PAGE_SIZE</code>.</li>
<li><code>:dictionary-page-size</code> - Defaults to <code>ParquetWriter/DEFAULT_PAGE_SIZE</code>.</li>
<li><code>:dictionary-enabled?</code> - Defaults to
<code>ParquetWriter/DEFAULT_IS_DICTIONARY_ENABLED</code>.</li>
<li><code>:validating?</code> - Defaults to <code>ParquetWriter/DEFAULT_IS_VALIDATING_ENABLED</code>.</li>
<li><code>:page-write-checksum?</code> - Defaults to true.  Output a crc check file in addition to
parquet file.</li>
<li><code>:writer-version</code> - Defaults to <code>ParquetWriter/DEFAULT_WRITER_VERSION</code>.</li>
</ul>
</div></div><div class="src-link"><a href="https://github.com/techascent/tech.ml.dataset/blob/master/src/tech/v3/libs/parquet.clj#L953">view source</a></div></div><div class="public anchor" id="var-parquet-.3Eds-seq"><h3>parquet-&gt;ds-seq</h3><div class="usage"><code>(parquet-&gt;ds-seq path options)</code><code>(parquet-&gt;ds-seq path)</code></div><div class="doc"><div class="markdown"><p>Given a string, hadoop path, or a parquet InputFile, return a sequence of datasets.
Column will have parquet metadata merged into their normal metadata.
Reader will be closed upon termination of the sequence.</p>
</div></div><div class="src-link"><a href="https://github.com/techascent/tech.ml.dataset/blob/master/src/tech/v3/libs/parquet.clj#L726">view source</a></div></div><div class="public anchor" id="var-parquet-.3Emetadata-seq"><h3>parquet-&gt;metadata-seq</h3><div class="usage"><code>(parquet-&gt;metadata-seq path)</code></div><div class="doc"><div class="markdown"><p>Given a local parquet file, return a sequence of metadata, one for each row-group.
A row-group maps directly to a dataset.</p>
</div></div><div class="src-link"><a href="https://github.com/techascent/tech.ml.dataset/blob/master/src/tech/v3/libs/parquet.clj#L718">view source</a></div></div></div></body></html>